Shaper Control Tool Readme

Download & update
=================

Project page at BitBucket:
  http://bitbucket.org/sky/sc/

Project page at Sourceforge:
  http://sourceforge.net/projects/sc-tool/

Source code repositories:
  http://bitbucket.org/sky/sc/src/
  http://sc-tool.hg.sourceforge.net/hgweb/sc-tool/
  http://mercurial.intuxication.org/hg/sc/


Installation
============

0. Install Linux kernel that supports "flow" classifier (version 2.6.25 or
higher, with option CONFIG_NET_CLS_FLOW=m or y).

1. Install Perl 5 and the following modules: 
AppConfig, Getopt::Long, DBI, DBD-module for your database (DBD::mysql,
DBD::SQLite, etc), Pod::Usage.

  a. Installation from package repository of your Linux distribution
     (recommended way).

     Example for Debian:
       apt-get install perl-doc perl-modules libdbi-perl libdbd-sqlite3-perl \
       libappconfig-perl

  b. Installation of non-core modules from CPAN.
    cpan DBI DBD::SQLite Pod::Usage AppConfig

2. Install fresh iproute2 suite that supports "flow" classifier.

3. Install iptables.

4. Install ipset (http://ipset.netfilter.org/).

5. Install sc.
  make install

If you want to create shaping rules at startup and clear them at shutdown, you
should prepare init script. sc comes with init script sc.init for Debian and
other distributions with compatible initialization scheme. To install it just
type
  cp sc.init /etc/init.d/sc

and don't forget to update rc.d symlinks.
  update-rc.d sc defaults


Configuration
=============

1. Database settings

By default, sc uses SQLite database at /etc/sc/sc.db, but it can use any other
DBI-compatible database like MySQL, PostgreSQL or Oracle. You must configure
database driver and SQL-queries that will produce correct output for sc. It is
assumed that IP-addresses and bandwidth rates are stored as integer numbers
(see query_create value). Default and recommended rate unit is 1 Kibit/s =
1024 bit/s. Remember that IP-addresses must differ in two last octets, because
they are used for deterministic mapping to a tc classid's.

If you plan to use shaper with it's own SQLite database, you need to create it
and add some data.

Example:
  sc dbcreate
  sc dbadd 172.16.0.1 10Mibit
  sc dbadd 172.16.0.2 20Mibit


2. Synchronization with database

To perform synchronization of shaping rules with database you should add
a corresponding line to your crontab file. In the following example
synchronization of rules will be performed every 10 minutes.

*/10 * * * * root /usr/local/sbin/sc sync

3. Syslog

sc can log errors and warnings through syslog. To turn on this
feature, set the "syslog" option to 1 in /etc/sc/sc.conf.

Testing & Usage
===============

Package includes "genbase" script that allows you to create database with
IP-addresses (from 172.16.0.0/16 by default) and random bandwidth rates.

