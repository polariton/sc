Shaper Control Tool Readme File

Download & update
=================

Project page at Sourceforge:
  http://sourceforge.net/projects/sc-tool/

Project page at BitBucket:
  http://bitbucket.org/sky/sc/

Source code repositories:
  http://bitbucket.org/sky/sc/src/
  http://mercurial.intuxication.org/hg/sc/
  http://sc-tool.hg.sourceforge.net/hgweb/sc-tool/


Installation
============

0. Install Linux kernel that supports "u32" classifier (CONFIG_NET_CLS_U32),
traffic control actions (CONFIG_NET_CLS_ACT, CONFIG_NET_ACT_GACT), traffic
policing (CONFIG_NET_ACT_POLICE), and (optionally) "flow" classifier
(CONFIG_NET_CLS_FLOW).

1. Install Perl 5 and the following modules:
AppConfig, DBI, DBD-module for your database (DBD::Pg, DBD::SQLite,
DBD::mysql, etc), Getopt::Long, Pod::Usage, Term::ANSIColor, Sys::Syslog.

  a. Installation from package repository of your Linux distribution.

     Example for Debian:
     # aptitude install perl perl-base perl-doc perl-modules libdbi-perl \
	     libdbd-sqlite3-perl libappconfig-perl

  b. Installation of modules from CPAN.
     # cpan AppConfig DBI DBD::SQLite Getopt::Long Pod::Usage \
	     Term::ANSIColor Sys::Syslog

If you see that the output of "sc help" command is broken, please update
Pod::Usage module from CPAN.

2. Install iproute2 suite. The latest version from
<http://deversources.linuxfoundation.org/dev/iproute2/download> is preferred.

3. Install iptables and ipset <http://ipset.netfilter.org/> if you are
planning to use "flow" classifier.

5. Install sc, manpages, configuration file and init script.

# make install

SC comes with prepared init script that should be installed to location
/etc/init.d/sc. To enable automatic start of the shaper script you should
create appropriate symlinks in the runlevel directories. In Debian and related
distributives you may use the following command:

# update-rc.d sc defaults


Configuration and usage
=======================

1. Database settings

By default, sc stores it's data in SQLite database at /etc/sc/sc.db, but it
can use any other DBI-compatible database server like MySQL, PostgreSQL or
Oracle. If you plan to load the data from a remote database on a dedicated
server, you must install corresponding Perl DBD module, configure database
driver and SQL-queries that will produce correct output for sc. The first
column must contain an IP-addresses in integer representation, and the second
column provides the integer bandwith rate values (see default value of
"query_create" parameter).

Rate units are defined by "rate_unit" parameter in sc.conf or by similar
command line option. Default rate unit is 1 Kibit/s = 1024 bit/s.

If you plan to use shaper with it's own SQLite database, you need to create it
and add some data.

# sc dbcreate
# sc dbadd 172.16.0.1 10Mibit
# sc dbadd 172.16.0.2 20Mibit

You may also use "genbase" script to generate some database entries with
random values of bandwidth rates.


2. Synchronization of rules with database

To perform the synchronization of the shaping rules with the database entries
you should edit your crontab file. The following example of crontab(5) entry
creates the cron(8) task which performs the synchronization of the rules every
10 minutes:

*/10 * * * * root /usr/local/sbin/sc sync

If you want to have rates that will differ from that stored in the database
you should edit the rate_ratio in the sc.conf file with the suitable cron
instruction. There is no need to reload the rules manually if you use the
task for syncronization every 10 minutes from the example above.

Examples of cron instructions for setting rate_ratio = 1.5 at 02:00 and
changing it back to 1.0 at 07:00 every day:

0 2 * * * root sed -i 's/^rate_ratio.*=.*/rate_ratio = 1.5/g' /etc/sc/sc.conf
0 7 * * * root sed -i 's/^rate_ratio.*=.*/rate_ratio = 1.0/g' /etc/sc/sc.conf

3. Syslog

SC can log errors and warnings through syslog. To enable this feature set
"syslog" option to 1 in /etc/sc/sc.conf.

